FROM node:22-bullseye

# Thư mục làm việc trong container
WORKDIR /app

# Copy package files trước để tận dụng cache layer
COPY package*.json ./

# Cài dependency sạch (dành cho CI/CD & team dev)
RUN npm ci --include=optional --ignore-scripts

# Copy toàn bộ code
COPY . .

# Fix Rollup bug (bỏ qua lỗi nếu có)
RUN npm rebuild rollup --include=optional || true

# Cho phép Vite bind ra ngoài
ENV NODE_ENV=development
ENV CHOKIDAR_USEPOLLING=true
ENV WATCHPACK_POLLING=true

EXPOSE 3000

CMD ["npm", "run", "dev"]
